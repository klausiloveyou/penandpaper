/*! penandpaper - 1.0.0 2019-01-24 */

window.pnp=window.pnp||{},jQuery,Array.prototype.pushDistinct||(Array.prototype.pushDistinct=function(element){-1===this.indexOf(element)&&this.push(element)}),String.prototype.endsWith||(String.prototype.endsWith=function(search,this_len){return(void 0===this_len||this_len>this.length)&&(this_len=this.length),this.substring(this_len-search.length,this_len)===search}),String.prototype.incrementTrailingNumber||(String.prototype.incrementTrailingNumber=function(){var trailingNumIdx=this.search(/[0-9]/),value=this.substring(trailingNumIdx,this.length);return this.substr(0,trailingNumIdx)+(parseInt(value)+1)}),String.prototype.removeTrailingNumber||(String.prototype.removeTrailingNumber=function(){var trailingNumIdx=this.search(/[0-9]/),value=this.substring(trailingNumIdx,this.length);return this.substr(0,trailingNumIdx)+(parseInt(value)+1)}),function(pnp,$,undefined){pnp.character={charObj:{},pageURLPram:"",keyUpEvent:null,init:function(){pnp.character.pageURLPram=pnp.util.urlQuery("p",!1).toLowerCase(),$(document).on("submit","form.api",function(e){e.preventDefault()}),$(document).on("click","form.api button#cancel",function(){var p=pnp.character.pageURLPram?"?p="+pnp.character.pageURLPram:"";window.location.href="/pages/characters.php"+p}),$(document).on("click","form.api button.operation",function(e){var target,buttonJ,operation,form,callback;pnp.character.keyUpEvent=null,target=e.target,buttonJ=$(target),operation=buttonJ.attr("id"),form=buttonJ.closest("form.api"),callback=function(){$.post("api/character.php",{chardata:JSON.stringify(pnp.character.charObj),operation:operation}).done(function(){"create"===operation?window.location.href="/pages/characters.php":"update"===operation&&pnp.ui.addAlertToMain("Your character data has been updated successfully.","Saved","info")}).fail(function(jqXHR,textStatus,errorThrown){alert(errorThrown)})},pnp.character.charObj={},$(form).find("fieldset").each(function(){var fieldset=$(this).attr("id");pnp.character.charObj[fieldset]={};var spansJ=$(this).find("span");spansJ.each(function(){var inputsJ=$(this).parent("div").nextUntil("div"),key=$(this).attr("id");if(1<inputsJ.length)inputsJ.each(function(i){pnp.util.addValueToCharObject(fieldset,key,$(this).val(),i)});else{var value=$(inputsJ).val();if(key[key.length-1].match(/[0-9]/)){var trailingNumIdx=key.search(/[0-9]/),idx=parseInt(key.substring(trailingNumIdx,key.length)),headingStr=key.substr(0,trailingNumIdx);pnp.util.addValueToCharObject(fieldset,headingStr,value,idx)}else pnp.util.addValueToCharObject(fieldset,key,value)}})}),callback()}),$(document).on("click","form fieldset div.input-group button",function(e){pnp.ui.appendNewInputGroup(e.target)}),function(){if(pnp.character.registerInputListener(),$("form.api").length&&$("form.api button#update").length){var what=pnp.character.pageURLPram?"?what="+pnp.character.pageURLPram:"?what=*";$.get("api/character.php"+what,function(data){!function(form,data){$.each(data,function(key1,value1){var cFieldset=$(form).find("fieldset#"+key1);if(!cFieldset.length)return!0;$.each(value1,function(key2,value2){Array.isArray(value2)?$.each(value2,function(key3,value3){var trailingNum=parseInt(key3)+1,input=$(cFieldset).find("input[aria-describedby='"+key2+trailingNum+"']");if(input.length)input.val(value3),trailingNum===value2.length&&""===value3||pnp.ui.appendNewInputGroup($(input).next("div").children("button"));else{var inputs=$(cFieldset).find("input[aria-describedby='"+key2+"']");$(inputs[key3]).val(value3)}}):$(cFieldset).find("input[aria-describedby='"+key2+"']").val(value2)})})}($("form.api"),data)}).fail(function(data){pnp.ui.addAlertToMain(data.responseText,"Error loading data","danger")})}}()},registerInputListener:function(){var inputs=$("form.api button.operation#update").closest("form.api").find("input");$(inputs).off(),$(inputs).on("keyup",function(e){pnp.character.keyUpEvent=e,setTimeout(function(){if(pnp.character.keyUpEvent===e)$(e.target).closest("form.api").find("button.operation#update")},1e4)})}}}(window.pnp=window.pnp||{},jQuery),function(pnp,$,undefined){pnp.ui={appendNewInputGroup:function(button){var srcDIG=$(button).closest("div.input-group"),input=$(srcDIG).find("input");if(""===input.val().trim())input.addClass("is-invalid"),input.val("");else{input.removeClass("is-invalid");var copy=srcDIG.clone();$(copy).find("input").val("");var newspan=$(copy).find("span"),newinput=$(copy).find("input"),incText=$(newspan).text().incrementTrailingNumber(),incID=$(newspan).attr("id").incrementTrailingNumber();$(newspan).attr("id",incID).text(incText),$(newinput).attr("aria-describedby",incID).attr("aria-label",incText),$(srcDIG).find("div.input-group-append").remove(),$(srcDIG).find("span").addClass("border-bottom-0"),$(input).addClass("border-bottom-0"),$(srcDIG).parent().append(copy),pnp.character.registerInputListener(),$("form.api button.operation").click()}},addAlertToMain:function(message,title,type){if(message){var alert=$('<div class="alert alert-'+(type||"info")+' alert-dismissible fade show" role="alert">\n                '+(title?"<strong>"+title+"!</strong> ":"")+message+'\n                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n            </div>');$(alert).fadeTo(5e3,500).slideUp(500,function(){$(alert).slideUp(500)}),$(alert).prependTo($("main"))}}}}(window.pnp=window.pnp||{},jQuery),function(pnp,$,undefined){pnp.util={addValueToCharObject:function(fieldset,key,value,idx){fieldset=fieldset.toLowerCase(),key=key.toLowerCase(),void 0!==idx?(pnp.character.charObj[fieldset].hasOwnProperty(key)||(pnp.character.charObj[fieldset][key]=[]),pnp.character.charObj[fieldset][key].splice(idx,0,$.trim(value.toString()))):pnp.character.charObj[fieldset][key]=$.trim(value.toString())},urlQuery:function(query,upperQuery){query=query.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var upper=null===upperQuery||upperQuery,results=new RegExp("[\\?&]"+query+"=([^&#]*)").exec(decodeURI(window.location.href));return null!==results?upper?decodeURIComponent(results[1]).toUpperCase():decodeURIComponent(results[1]):""}}}(window.pnp=window.pnp||{},jQuery);
//# sourceMappingURL=pnp.min.js.map